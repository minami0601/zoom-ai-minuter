# Zoom会議自動議事録化システム要件定義書

## 1. 概要

### 1.1 目的

本システムは、Zoom会議の録画から自動的に文字起こしを取得し、生成AIを活用して会議の要約と議事録を作成するシステムである。これにより、会議記録の作成工数を削減し、情報共有の効率化を図ることを目的とする。

### 1.2 背景

現状、Zoomには文字起こし機能が存在するが、フィラーや冗長な表現が多く含まれており、そのままでは議事録として使用することが難しい。また、会議内容を共有するためには、手動で議事録を作成する必要があり、多くの工数を要している。このような課題を解決するため、自動化システムの構築が求められている。

### 1.3 スコープ

本システムは以下の機能を提供する：

- Zoom Webhookを利用した文字起こしデータの自動取得
- 文字起こしデータの前処理と変換
- 生成AIによる会議内容の分類と要約
- 構造化された議事録の自動生成
- Notionへの議事録自動出力

## 2. 技術要件

### 2.1 使用技術

| カテゴリ | 技術/ライブラリ | バージョン | 備考 |
|---------|----------------|----------|------|
| 実行環境 | Cloudflare Workers | - | サーバーレス環境 |
| Webフレームワーク | Hono | 最新版 | 軽量かつ高速なWebフレームワーク |
| バリデーター | Valibot | 最新版 | TypeScript向け軽量バリデーションライブラリ |
| フォーマッター | Biome | 最新版 | 高速なJavaScript/TypeScriptフォーマッター |
| テストフレームワーク | Vitest | 最新版 | Viteベースの高速テストランナー |
| Node管理 | mise または asdf | 最新版 | Nodeバージョン管理ツール |
| パッケージマネージャー | pnpm | 最新版 | ディスク効率の良いパッケージマネージャー |
| 日付操作 | date-fns | 最新版 | 軽量な日付操作ライブラリ |
| 関数型ユーティリティ | remeda | 最新版 | TypeScript向け関数型ユーティリティ |
| AI API | Google Gemini API | 最新版 | テキスト生成・分析 |
| データストレージ | Cloudflare Workers KV | - | キーバリューストレージ |
| 外部連携 | Notion API | 最新版 | 議事録出力用 |
| 外部連携 | Zoom API | 最新版 | 文字起こしデータ取得用 |

### 2.2 開発環境要件

- TypeScript: 最新の安定版
- Node.js: LTS版 (v20.x以上)
- GitHubリポジトリでのバージョン管理
- GitHub Actionsによる自動テスト・デプロイ
- セキュアな環境変数管理

## 3. 機能要件

### 3.1 Zoom Webhook連携

| 要件ID | 要件 | 優先度 | 備考 |
|-------|-----|--------|------|
| F1.1 | Zoomから「Recording Transcript files have completed」イベントを受け取るエンドポイントを提供する | 高 | Webhook検証にも対応すること |
| F1.2 | Webhookからペイロードとダウンロードトークンを抽出する | 高 | |
| F1.3 | 受信したWebhookの内容をログに記録する | 中 | トラブルシューティング用 |
| F1.4 | Webhookの認証・検証を行う | 高 | セキュリティ対策として |

### 3.2 文字起こしデータ処理

| 要件ID | 要件 | 優先度 | 備考 |
|-------|-----|--------|------|
| F2.1 | Zoom APIを使用して文字起こしファイル(VTT形式)を取得する | 高 | |
| F2.2 | VTT形式から話者とタイムスタンプ付きのテキストに変換する | 高 | |
| F2.3 | 処理状態をKVストレージに保存する | 中 | 障害復旧のため |
| F2.4 | 長時間実行を考慮した非同期処理の仕組みを実装する | 高 | Workers実行時間制限対応 |

### 3.3 会議内容の分類

| 要件ID | 要件 | 優先度 | 備考 |
|-------|-----|--------|------|
| F3.1 | Gemini APIを使用して会議内容をカテゴリに分類する | 高 | |
| F3.2 | 分類カテゴリー: 業務(internalMeeting), 雑談(smallTalk), 個人的(private), その他(other) | 高 | |
| F3.3 | 雑談・個人的・その他に分類された場合は処理を中止する | 中 | リソース節約のため |
| F3.4 | 分類結果と理由をKVストレージに保存する | 中 | |

### 3.4 議事録生成

| 要件ID | 要件 | 優先度 | 備考 |
|-------|-----|--------|------|
| F4.1 | 全体要約を生成する | 高 | 会議の主旨、参加者、決定事項等 |
| F4.2 | トピック別の発言タイムラインを生成する | 高 | 時系列で話の流れを追えるように |
| F4.3 | テキストをチャンクに分割して処理する | 高 | AIのトークン制限対応 |
| F4.4 | マークダウン形式で構造化された議事録を作成する | 高 | |
| F4.5 | 決定事項・アクションアイテムを明確に抽出する | 高 | |

### 3.5 Notion連携

| 要件ID | 要件 | 優先度 | 備考 |
|-------|-----|--------|------|
| F5.1 | Notion APIを使用して指定のデータベースに議事録を作成する | 高 | |
| F5.2 | 会議タイトル、日時、参加者などのメタデータを設定する | 高 | |
| F5.3 | 会議の種類（カテゴリ）をプロパティとして設定する | 中 | フィルタリング用 |
| F5.4 | 生成した議事録をマークダウン形式でNotionページに出力する | 高 | |
| F5.5 | 処理完了後、Notionページへのリンクを返却する | 中 | |

### 3.6 エラー処理・リカバリー

| 要件ID | 要件 | 優先度 | 備考 |
|-------|-----|--------|------|
| F6.1 | 各処理ステップでのエラーを適切にハンドリングする | 高 | |
| F6.2 | 処理状態をKVストレージに保存し、障害時に復旧可能にする | 高 | |
| F6.3 | 一時的なネットワークエラーに対するリトライ機能 | 中 | |
| F6.4 | エラーログを適切に記録する | 高 | トラブルシューティング用 |

### 3.7 管理・モニタリング機能

| 要件ID | 要件 | 優先度 | 備考 |
|-------|-----|--------|------|
| F7.1 | 処理状態確認用のAPIエンドポイントを提供する | 中 | ジョブのステータス確認用 |
| F7.2 | ヘルスチェック用のエンドポイントを提供する | 中 | |
| F7.3 | 主要な処理の実行時間・成功率などのメトリクスを記録する | 低 | パフォーマンスモニタリング用 |

## 4. 非機能要件

### 4.1 パフォーマンス要件

| 要件ID | 要件 | 目標値 | 備考 |
|-------|-----|--------|------|
| NF1.1 | Webhook受信から処理開始までの応答時間 | 3秒以内 | |
| NF1.2 | 1時間の会議の議事録生成にかかる合計時間 | 5分以内 | |
| NF1.3 | 同時処理可能なジョブ数 | 10件以上 | |

### 4.2 セキュリティ要件

| 要件ID | 要件 | 優先度 | 備考 |
|-------|-----|--------|------|
| NF2.1 | APIキーなどの秘密情報はCloudflare Secretsで管理する | 高 | |
| NF2.2 | Zoom Webhookの検証を実装する | 高 | なりすまし防止 |
| NF2.3 | すべてのAPIエンドポイントに適切な認証を実装する | 高 | |
| NF2.4 | 個人情報や機密情報を含む会議は処理対象外とする | 高 | プライバシー保護 |

### 4.3 可用性要件

| 要件ID | 要件 | 目標値 | 備考 |
|-------|-----|--------|------|
| NF3.1 | システム稼働率 | 99.9%以上 | Cloudflare Workers の SLA に依存 |
| NF3.2 | 計画外ダウンタイムからの復旧時間 | 1時間以内 | |
| NF3.3 | バックアップと復元の仕組み | 日次 | KVストレージのバックアップ |

### 4.4 保守性要件

| 要件ID | 要件 | 優先度 | 備考 |
|-------|-----|--------|------|
| NF4.1 | コードの静的解析とフォーマット | 高 | Biome を使用 |
| NF4.2 | ユニットテストのカバレッジ | 80%以上 | Vitest で実装 |
| NF4.3 | ドキュメントの充実度 | 高 | 開発者向け・管理者向け |
| NF4.4 | モジュール化・コンポーネント化 | 高 | 保守性向上のため |

### 4.5 拡張性要件

| 要件ID | 要件 | 優先度 | 備考 |
|-------|-----|--------|------|
| NF5.1 | 新しい出力先の追加が容易な設計 | 中 | Notion以外の連携先 |
| NF5.2 | AIモデルの切り替えが容易な設計 | 中 | 将来的なモデル改善対応 |
| NF5.3 | 会議分類のカスタマイズに対応 | 低 | ユーザー要望に応じて |

## 5. データモデル

### 5.1 Workers KVストレージ構造

| キー形式 | 値の内容 | 用途 |
|---------|---------|------|
| `job:{uuid}` | ジョブメタデータ (JSON) | 処理状態、結果の管理 |
| `transcript:{uuid}` | 文字起こしテキスト | 大きなテキストデータの保存 |

### 5.2 ジョブデータモデル

```typescript
interface JobData {
  // 基本情報
  jobId: string;
  createdAt: string;

  // Zoomデータ
  payload: {
    object: {
      uuid: string;
      topic: string;
      start_time: string;
      recording_files: Array<{
        file_type: string;
        download_url: string;
        // その他のファイルメタデータ
      }>
    }
  };
  downloadToken: string;

  // 処理状態
  status: 'pending' | 'processing' | 'completed' | 'failed' | 'skipped';
  processingStartedAt?: string;
  completedAt?: string;

  // 分類結果
  category?: 'internalMeeting' | 'smallTalk' | 'private' | 'other';
  reason?: string;

  // 出力情報
  notionPageId?: string;

  // エラー情報
  error?: string;
}
```

### 5.3 Notionデータベース構造

| プロパティ名 | 型 | 説明 |
|------------|---|------|
| Title | タイトル | 会議タイトル |
| Date | 日付 | 会議日時 |
| Category | セレクト | 会議の種類 |
| Summary | リッチテキスト | 会議の要約 |
| Timeline | リッチテキスト | 発言タイムライン |
| Decisions | リッチテキスト | 決定事項 |
| ActionItems | リッチテキスト | アクションアイテム |
| ZoomMeetingId | テキスト | Zoom会議ID (紐付け用) |

## 6. APIエンドポイント設計

### 6.1 Zoom Webhook受信エンドポイント

**エンドポイント**: `/api/zoom-webhook`
**メソッド**: POST
**説明**: Zoomから会議文字起こし完了通知を受け取る

**リクエスト**:
```typescript
interface ZoomWebhookRequest {
  payload: {
    object: {
      uuid: string;
      topic: string;
      start_time: string;
      recording_files: Array<{
        file_type: string;
        download_url: string;
        // その他のファイルメタデータ
      }>
    }
  };
  download_token: string;
  // その他のWebhookペイロード
}
```

**レスポンス**:
```typescript
interface ZoomWebhookResponse {
  success: boolean;
  message: string;
  jobId?: string;
}
```

### 6.2 文字起こし処理エンドポイント

**エンドポイント**: `/api/process-transcript`
**メソッド**: POST
**説明**: 文字起こしファイルを処理して議事録を生成する

**リクエスト**:
```typescript
interface ProcessTranscriptRequest {
  jobId: string;
}
```

**レスポンス**:
```typescript
interface ProcessTranscriptResponse {
  success: boolean;
  message: string;
  status: 'processing' | 'completed' | 'skipped' | 'failed';
  category?: string;
  reason?: string;
  notionPageId?: string;
  error?: string;
}
```

### 6.3 ジョブ状態確認エンドポイント

**エンドポイント**: `/api/job/:jobId`
**メソッド**: GET
**説明**: 処理ジョブの現在の状態を取得する

**パスパラメータ**:
- `jobId`: 処理ジョブのUUID

**レスポンス**:
```typescript
interface JobStatusResponse {
  jobId: string;
  status: 'pending' | 'processing' | 'completed' | 'failed' | 'skipped';
  createdAt: string;
  processingStartedAt?: string;
  completedAt?: string;
  category?: string;
  notionPageId?: string;
  error?: string;
}
```

### 6.4 ヘルスチェックエンドポイント

**エンドポイント**: `/api/health`
**メソッド**: GET
**説明**: システムの稼働状態を確認する

**レスポンス**:
```typescript
interface HealthResponse {
  status: 'ok' | 'degraded' | 'outage';
  version: string;
  timestamp: string;
}
```

## 7. アーキテクチャ設計

### 7.1 アーキテクチャの原則

プロジェクトのコア設計原則として、以下の方針を採用します：

1. **機能ベースのディレクトリ構造**:
   - `features/` 配下に機能名のディレクトリを作成する
   - 各機能は自己完結した形で実装し、他の機能との依存を最小限に抑える

2. **ユースケース中心の設計**:
   - 各機能ディレクトリ内に `usecase.ts` を作成し、そこに1つのユースケースを達成する関数を定義する
   - `features/` 配下の `usecase.ts` を見ていけばアプリで何ができるのかわかるようにする
   - ユースケース関数は原則として単一責任の原則に従う

3. **ドメインロジックの分離**:
   - `usecase.ts` が肥大化するのを防ぐために同ディレクトリ内に `domain.ts` を作成
   - ドメインロジック、型定義、ビジネスルールを `domain.ts` に配置

4. **外部サービス依存の低減**:
   - `lib/` 配下に外部APIやSDKの薄いラッパーを実装
   - `lib` は `features` に依存してはならない（逆は許容）
   - 各種APIクライアント・SDKは直接参照せず、必ず `lib` 層を経由する

5. **オニオンアーキテクチャの採用**:
   - 依存関係の方向を内側に向ける
   - 機能ごとに分割することで認知的負荷を下げる

6. **明確な関心の分離**:
   - ルーティングとハンドラ（`routes/`）
   - ビジネスロジック（`features/*/usecase.ts`）
   - ドメインモデル（`features/*/domain.ts`）
   - 外部サービス（`lib/`）

このアプローチにより、機能の理解、テスト、メンテナンスが容易になり、長期的な保守性が向上します。

### 7.2 コンポーネント構成

以下のディレクトリ構造は、機能ごとの分割を行い、オニオンアーキテクチャの原則を採用しながら認知的負荷を下げる設計を実現しています：

```
src/
├── index.ts                           # エントリーポイント
├── app.ts                             # Honoアプリケーション
├── features/                          # 機能別モジュール
│   ├── webhook/                       # Zoom Webhook処理機能
│   │   ├── usecase.ts                 # Webhookのユースケース
│   │   ├── domain.ts                  # ドメインロジック・型定義
│   │   └── validation.ts              # 入力バリデーション
│   ├── transcript/                    # 文字起こし処理機能
│   │   ├── usecase.ts                 # 文字起こし処理のユースケース
│   │   ├── domain.ts                  # ドメインロジック・型定義
│   │   └── format.ts                  # フォーマット変換ロジック
│   ├── classification/                # 会議分類機能
│   │   ├── usecase.ts                 # 分類処理のユースケース
│   │   ├── domain.ts                  # ドメインロジック・型定義
│   │   └── prompts.ts                 # AIプロンプトテンプレート
│   ├── summarization/                 # 議事録生成機能
│   │   ├── usecase.ts                 # 要約処理のユースケース
│   │   ├── domain.ts                  # ドメインロジック・型定義
│   │   └── prompts.ts                 # AIプロンプトテンプレート
│   ├── notion/                        # Notion連携機能
│   │   ├── usecase.ts                 # Notion出力のユースケース
│   │   ├── domain.ts                  # ドメインロジック・型定義
│   │   └── templates.ts               # Notionページテンプレート
│   └── job/                          # ジョブ管理機能
│       ├── usecase.ts                 # ジョブ処理のユースケース
│       └── domain.ts                  # ドメインロジック・型定義
├── lib/                               # 外部サービス連携
│   ├── zoom.ts                        # Zoom API薄いラッパー
│   ├── gemini.ts                      # Gemini API薄いラッパー
│   ├── notion.ts                      # Notion API薄いラッパー
│   └── storage/                       # ストレージ関連
│       └── kv.ts                      # Workers KV薄いラッパー
├── routes/                            # APIルート定義
│   ├── webhook.ts                     # Webhook APIルート
│   ├── process.ts                     # 処理APIルート
│   ├── job.ts                         # ジョブAPIルート
│   └── health.ts                      # ヘルスチェックAPIルート
└── utils/                             # 共通ユーティリティ
    ├── validation.ts                  # バリデーションユーティリティ
    ├── error.ts                       # エラーハンドリング
    ├── logging.ts                     # ロギングユーティリティ
    ├── date.ts                        # 日付操作ユーティリティ
    └── format.ts                      # フォーマット変換ユーティリティ
```

### 7.3 処理フロー

1. Zoom会議録画完了時にWebhookが発火
2. システムがWebhookを受信し、ジョブ情報をKVに保存
3. 非同期で文字起こしファイルのダウンロードと処理を開始
4. 文字起こしデータを前処理し、テキスト形式に変換
5. Gemini APIを使用して会議内容を分類
6. 分類結果が処理対象の場合、議事録生成処理を実行
7. 全体要約とトピック別タイムラインを生成
8. 構造化された議事録をNotionに出力
9. 処理結果をKVに保存

## 8. プロジェクト計画

### 8.1 マイルストーン

| フェーズ | 説明 | 期間 |
|---------|------|------|
| 要件定義・設計 | 要件のレビューと詳細設計 | 1週間 |
| 開発環境構築 | リポジトリ作成、CI/CD設定 | 3日 |
| コア機能実装 | 基本機能の実装 | 2週間 |
| テスト | ユニットテスト、統合テスト | 1週間 |
| デプロイ・試験運用 | 本番環境への展開と試験運用 | 1週間 |
| 運用開始 | 正式運用開始 | - |

### 8.2 開発プロセス

1. GitHubでのIssue管理とPull Requestベースの開発
2. GitHub Actionsによる自動テスト・ビルド・デプロイ
3. コードレビューの実施
4. ドキュメント更新

## 9. テスト計画

### 9.1 テスト種別

| テスト種別 | 説明 | ツール |
|-----------|------|-------|
| ユニットテスト | 各関数・モジュールの単体テスト | Vitest |
| 統合テスト | APIエンドポイントの結合テスト | Vitest + SuperTest |
| E2Eテスト | 実際のZoom APIとの連携テスト | 手動 + 自動化スクリプト |

### 9.2 テスト環境

- 開発環境: ローカル開発サーバー
- ステージング環境: Cloudflare Workers (テスト用)
- 本番環境: Cloudflare Workers (本番用)

## 10. 運用・保守計画

### 10.1 監視体制

- Cloudflare Analyticsによるパフォーマンスモニタリング
- エラーログの定期確認
- 処理状況の定期レポート

### 10.2 バックアップ計画

- KVストレージの定期的なバックアップ
- 設定情報のバージョン管理

### 10.3 障害対応

- エラー検知時の通知設定
- 復旧手順の文書化
- インシデント管理プロセスの確立

## 11. セキュリティ対策

### 11.1 認証・認可

- Zoom Webhook検証の実装
- APIエンドポイントへのアクセス制限
- APIキー・トークンの定期的なローテーション

### 11.2 機密情報の取り扱い

- 個人情報・機密情報の検出と適切な処理
- センシティブな内容を含む会議の処理回避

### 11.3 脆弱性対策

- 依存パッケージの脆弱性スキャン
- セキュリティアップデートの適用

## 12. 導入効果と測定指標

### 12.1 期待される効果

- 議事録作成の工数削減: 会議1回あたり約30分の工数削減
- 情報共有の迅速化: 会議終了後30分以内に議事録が共有可能
- 情報アクセス性の向上: 一元管理された議事録による検索性の向上

### 12.2 測定指標

- 処理された会議数: 日次/週次/月次
- 議事録生成の成功率
- 処理時間の平均・中央値
- ユーザー満足度調査

## 13. 今後の展望

### 13.1 拡張予定機能

- Slack/Teams等への議事録通知機能
- 会議録の検索・分析ダッシュボード
- 定期会議のトレンド分析機能
- 複数言語対応

### 13.2 AI処理の改善計画

- より精緻なカスタムプロンプトの開発
- Fine-tuningによるドメイン特化型AIの検討
- 音声解析による話者識別精度の向上

## 付録

### A. システム設定パラメータ

| パラメータ名 | 説明 | デフォルト値 | 変更可否 |
|------------|-----|------------|--------|
| CHUNK_SIZE | テキスト分割サイズ | 4000 | 可 |
| RETRY_COUNT | API呼び出しリトライ回数 | 3 | 可 |
| RETRY_DELAY | リトライ間隔(ms) | 1000 | 可 |
| JOB_TIMEOUT | ジョブのタイムアウト時間(秒) | 300 | 可 |

### B. エラーコードと対応方法

| エラーコード | 説明 | 対応方法 |
|------------|-----|--------|
| E001 | Webhook検証失敗 | Zoom Webhook設定を確認 |
| E002 | 文字起こしファイル取得失敗 | ダウンロードトークンの有効期限を確認 |
| E003 | AI API呼び出しエラー | APIキー・クォータを確認 |
| E004 | Notion API呼び出しエラー | APIキー・権限設定を確認 |
| E005 | 処理タイムアウト | チャンクサイズの調整を検討 |

### C. プロンプトテンプレート例

```
# 会議分類プロンプト

あなたは会議の文字起こしデータを高精度で分類する専門AIです。
以下の分類基準に従って、入力される会議テキストを分析してください。

# 分類カテゴリーと判断基準

## smallTalk
- 業務に直接関係のない雑談
- キーワード例: 週末の予定、天気、食事

## internalMeeting
- プロジェクト進捗や課題の共有
- キーワード例: タスク、進捗、スケジュール

## private
- 個人的な相談や評価
- キーワード例: 相談、キャリア、評価

## other
- 上記に分類できない場合

# 出力形式
{
  "category": "選択したカテゴリー",
  "reason": "選択理由"
}

文字起こしは以下です:
${text}
```
